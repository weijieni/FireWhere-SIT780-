<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin</title>

    <!-- Compiled and minified CSS -->

    <!-- Materialize icons-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.js"></script>
</head>

<!-- <link href="style.sass" rel="stylesheet"> -->
<link href="styles.css" rel="stylesheet">

<body>
    <div class="container_main flex">
        <!-- side nav bar -->
        <div class="navsection">
            <header class="flex" style="justify-content: center; align-items: center;">
                <a id="navwelcome" href="#" onclick="handleTab('#welcome', '#navwelcome')"><img
                        src="assets/logo.png" /></a>
            </header>
            <ul class="navcontent">
                <li><button id="navbutton_1" class="navbutton" onclick="handleTab('#overview', '#navbutton_1')"><img
                            class="btn_icon" src="assets/map.png" />Overview</button></li>
                <li>
                    <a href="#" class="li_a" id="nav_dev"><img class="btn_icon" src="assets/predict.png" />Conditional
                        Prediction</a>
                    <div class="nav_box" id="dev_item" style="display: none;">
                        <button id="navbutton_2" onclick="handleTab('#temperature', '#navbutton_2')"
                            class="nav_item navbutton"><img class="btn_icon"
                                src="assets/tempereture.png" />Temperature</button>
                        <button id="navbutton_3" onclick="handleTab('#humidity', '#navbutton_3')"
                            class="nav_item navbutton"><img class="btn_icon"
                                src="assets/humidity.png" />Humidity</button>
                        <button id="navbutton_4" onclick="handleTab('#season', '#navbutton_4')"
                            class="nav_item navbutton"><img class="btn_icon" src="assets/season.png" />Season</button>
                    </div>
                </li>
                <li><button id="navbutton_5" class="navbutton" onclick="handleTab('#warning', '#navbutton_5')"><img
                            class="btn_icon" src="assets/warning.png" />Warnings</button></li>
                <li><button id="navbutton_6" class="navbutton" onclick="handleTab('#data', '#navbutton_6')"><img
                            class="btn_icon" src="assets/data.png" />Data</button></li>
                <li><button id="navbutton_7" class="navbutton" onclick="handleTab('#research', '#navbutton_7')"><img
                            class="btn_icon" src="assets/research.png" />Research</button></li>
                <!-- <li><button id="navbutton_8" class="navbutton" onclick="handleTab('#user', '#navbutton_8')"><img
                            class="btn_icon" src="assets/signup.png" />Sign up your detail!</button></li> -->
                <li><button id="navbutton_9" class="navbutton" onclick="handleTab('#admin', '#navbutton_9')"><img
                            class="btn_icon" src="assets/signup.png" />Admin Logout</button></li>
            </ul>
        </div>

        <!-- tab pages -->
        <div class="mainsection flex" style="flex-direction: column;">
            <nav class="navtop">
                <div style="display: flex; flex-direction: row; align-items: center;">
                    <a href="#" class="nav_icon"><i class="medium material-icons">reorder</i></a>
                    <h5 id="tab_title" style="margin-left: 20px; text-transform: uppercase;">Welcome</h5>
                </div>
                <div style="display: flex; flex-direction: row; align-items: center;">
                    <img style="min-width: 16px; min-height: 16px; height: 16px; width: 16px;" src="assets/user.png" />
                    <div
                        style="min-width: auto; min-height: 16px; height: 16px; width: auto; padding-left: 12px; padding-right: 12px;">
                        Online Users: <span id="count">0</span>
                    </div>
                </div>
            </nav>

            <!-- welcome -->
            <div class="pages" id="welcome"
                style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <img src="assets/logo2.png" /><br>
                <h2>A bushfire prediction and warning system. Welcome!</h2>
            </div>

            <!-- overview (vertor map) tab -->
            <div class="pages flex" id="overview">
                <div class="map_container" id="map_container">
                    <div id="map"></div>
                    <div id="VIC_content">
                        <span>Warning Level: </span><br />
                        <span style="color: red;">HIGH</span>
                    </div>
                    <div id="NSW_content">
                        <span>Warning Level: </span><br />
                        <span style="color: red;">HIGH</span>
                    </div>
                    <div id="QLD_content">
                        <span>Warning Level: </span><br />
                        <span style="color: red;">HIGH</span>
                    </div>
                    <div id="NT_content">
                        <span>Warning Level: </span><br />
                        <span style="color: red;">HIGH</span>
                    </div>
                    <div id="SA_content">
                        <span>Warning Level: </span><br />
                        <span style="color: red;">HIGH</span>
                    </div>
                    <div id="WA_content">
                        <span>Warning Level: </span><br />
                        <span style="color: red;">HIGH</span>
                    </div>
                    <div id="TAS_content">
                        <span>Warning Level: </span><br />
                        <span style="color: red;">HIGH</span>
                    </div>
                </div>
            </div>

            <!-- conditional prediction tab: temperature subtab -->
            <div class="pages flex" id="temperature">
                <div style="padding: 0 5px;">
                    <table id="temperature_table" data-height="600" data-pagination="true" data-search=”true”>
                        <thead>
                            <tr>
                                <th data-sortable="true" data-field="region">Region</th>
                                <th data-sortable="true" data-field="temperature">Tempereture</th>
                                <th data-sortable="true" data-field="warning">Warning</th>
                                <th data-sortable="true" data-field="urgent">Urgent</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>

            <!-- conditional prediction tab: humidity subtab -->
            <div class="pages flex" id="humidity">
                <div style="padding: 0 5px;">
                    <table id="humidity_table" data-height="600" data-search="true" data-pagination="true">
                        <thead>
                            <tr>
                                <th data-sortable="true" data-field="region" data-title="Region"></th>
                                <th data-sortable="true" data-field="humidity">Humidity</th>
                                <th data-sortable="true" data-field="warning">Warning</th>
                                <th data-sortable="true" data-field="urgent">Urgent</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>

            <!-- conditional prediction tab: season subtab -->
            <div class="pages flex" id="season">
                <div style="padding: 0 5px;">
                    <table id="season_table" data-search="true" data-height="600" data-pagination="true">
                        <thead>
                            <tr>
                                <th data-sortable="true" data-field="region">Region</th>
                                <th data-sortable="true" data-field="season">Season</th>
                                <th data-sortable="true" data-field="warning">Warning</th>
                                <th data-sortable="true" data-field="urgent">Urgent</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>

            <!-- warning tab -->
            <div class="pages flex" id="warning">
                <!-- success alert -->
                <div id="notification" class="notification">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                        </symbol>
                    </svg>
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
                        <div>
                          Warning Message Send Successfully!
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                </div>
                <div style="padding: 0 5px;">
                    <table id="warning_table" data-search="true" data-pagination="true" data-height="600">
                        <thead>
                            <tr>
                                <th data-sortable="true" data-field="region">Region</th>
                                <th data-sortable="true" data-field="warning">Warning</th>
                                <th data-sortable="true" data-field="warning_message" data-formatter="operateFormatter">
                                    Warning Message</th>
                                <th data-sortable="true" data-field="urgent">Urgent</th>
                            </tr>
                        </thead>
                    </table>
                </div>
                <!-- warning message dialog -->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Warning Message</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                Bush fire warning message: 
                            </div>
                            <div id="message"></div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="send">Send
                                    SMS</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- data tab -->
            <div class="pages flex" id="data">
                <div class="dropdown dropdown_extra">
                    <label style="margin-right: 10px;">Region</label>
                    <select class="form-select-sm" aria-label="region">
                        <option value="" selected>All</option>
                        <option value="1">New South Wales</option>
                        <option value="2">Queensland</option>
                        <option value="3">South Australia</option>
                        <option value="4">Tasmania</option>
                        <option value="5">Victoria</option>
                        <option value="6">Western Australia</option>
                    </select>
                </div>
                <div class="dropdown dropdown_extra">
                    <label style="margin-right: 10px;">Temperature</label>
                    <select class="form-select-sm" aria-label="Temperature">
                        <option value="" selected>All</option>
                        <option value="1">Below 30℃</option>
                        <option value="2">30℃ - 35℃</option>
                        <option value="3">35℃ - 40℃</option>
                        <option value="4">Exceed 40℃</option>
                    </select>
                </div>
                <div class="dropdown dropdown_extra">
                    <label style="margin-right: 10px;">Humidity</label>
                    <select class="form-select-sm" aria-label="Humidity">
                        <option value="" selected>All</option>
                        <option value="1">Below 30%</option>
                        <option value="2">30% - 70%</option>
                        <option value="3">Exceed 70%</option>
                    </select>
                </div>
                <div class="dropdown dropdown_extra">
                    <label style="margin-right: 10px;">Bush Fire Level</label>
                    <select class="form-select-sm" aria-label="Level">
                        <option value="" selected>All</option>
                        <option value="1">Low-moderate</option>
                        <option value="2">High</option>
                        <option value="3">Very High</option>
                        <option value="4">Severe</option>
                        <option value="5">Extreme</option>
                        <option value="6">Catastrophic</option>
                    </select>
                </div>
                <div class="dropdown dropdown_extra">
                    <label style="margin-right: 10px;">Warning</label>
                    <select class="form-select-sm" aria-label="Warning">
                        <option value="" selected>All</option>
                        <option value="1">Green</option>
                        <option value="2">Blue</option>
                        <option value="3">Yellow</option>
                        <option value="4">Orange</option>
                        <option value="5">Red</option>
                        <option value="6">Code Red</option>
                    </select>
                </div>
                <button type="button" class="btn btn-primary btn_extra">Search</button>
                <button type="button" class="btn btn-secondary btn_extra">Clear</button>
                <div style="padding: 0 5px;">
                    <table id="data_table" data-height="600" data-pagination="true" data-style="border: none">
                        <thead>
                            <tr>
                                <th data-field="region">Region</th>
                                <th data-field="temperature">Temperature</th>
                                <th data-field="humidity">Humidity</th>
                                <th data-field="bushfire_level">Bush Fire Level</th>
                                <th data-field="warning">Warning</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>

            <!-- research tab -->
            <div class="pages" id="research">
                <div class="research_box">
                    <div id="research_cards"></div>
                </div>
            </div>
            <!-- user sign up tab -->
            <div class="pages flex" id="user">
                <div class="container" style="margin-top: 50px">
                    <h4>Please sign up your details to receive warning message.</h4><br>
                    <form id="us-form">
                        <div class="form-floating mb-3">
                            <input type="phone" class="form-control" id="phone" placeholder="Phone">
                            <label for="floatingInput">Phone number</label>
                        </div>
                        <div class="form-floating">
                            <input type="region" class="form-control" id="region" placeholder="Region">
                            <label for="floatingRegion">Region</label>
                        </div>
                        <br>
                        <div class="card text-center">
                            <button type="submit" class="btn btn-primary btn-lg" onclick="window.dialog.show();">Sign up
                                Now</button>
                            <dialog id="dialog">
                                Sign up successful! <br> You will receive warning message by SMS. <br><br>
                                <button onclick="window.dialog.close();">close</button>
                            </dialog>
                        </div>
                    </form>
                    </form>
                </div>
            </div>

            <!-- admin Logout tab -->
            <div class="pages flex" id="admin">
                <div class="container" style="margin-top: 50px">
                    <form id="logout-form">
                        <br>
                        <div class="card text-center">
                            <button type="submit" class="btn btn-primary btn-lg">Logout</button>
                        </div>
                    </form>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- user details insert -->
    <script>
        const form = document.getElementById('us-form')
        form.addEventListener('submit', registerUser)

        async function registerUser(event) {
            event.preventDefault()
            const phone = document.getElementById('phone').value
            const region = document.getElementById('region').value

            const result = await fetch('/api/userdetail', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    phone,
                    region
                })
            }).then((res) => res.json())
            console.log(result)
        }
    </script>

    <!-- fetch data from database -->
    <script>
        // humidity data
        $(humidity_table).bootstrapTable({
            classes: 'table',
            url: '/api/gethumidity'
        });
        // temperature data
        $(temperature_table).bootstrapTable({
            classes: 'table',
            url: '/api/gettemperature'
        });
        // season data
        $(season_table).bootstrapTable({
            classes: 'table',
            url: '/api/getseason'
        });
        // warning data
        // $(warning_table).bootstrapTable({
        //     classes: 'table',
        //     url: '/api/getwaring'
        // });
    </script>
    <script>
        window.onload = async function () {
            const result = await fetch('/api/admin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
            }).then((res) => res.json())
            const { status } = result;
            if (status === 'fail') {
                window.location.href = '/index.html'
            }
        }
    </script>
    <!-- Admin logout -->
    <script>
        const logoutForm = document.getElementById('logout-form')
        logoutForm.addEventListener('submit', logoutAdmin)

        async function logoutAdmin(event) {
            event.preventDefault()

            const result = await fetch('/api/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
            }).then((res) => res.json())
            console.log(result)
            const { status } = result;
            if (status === 'ok') {
                window.location.href = '/index.html'
            }
        }
    </script>




    <!-- jQuery -->
    <script src="jquery-2.0.0.min.js"></script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Bootstrap table -->
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css">
    <script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.js"></script>
    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
        crossorigin="anonymous"></script>
    <!-- Google Map API -->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAtbKIID5sZzw5lu7otU960DnXQzwtGkG4&callback=initMap&libraries=&v=weekly"
        async></script>
    <!-- Google Map -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="env.js"></script>
    <!-- socket IO Served by the server -->
    <script>
        socket.on('usercnt', function (msg) {
            document.getElementById("count").innerHTML = msg;
        })
    </script>
    <!-- <script type="module" src="SMS.js"></script> -->
</body>

</html>